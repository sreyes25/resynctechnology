---
// src/pages/invoiceamericano/paymentsuccess.astro
import BaseLayout from "../../layouts/BaseLayout.astro";

// Optional query params you can append from Stripe/:
// ?invoice=abc123
// ?amount=125.00&currency=USD
const sp = Astro.url.searchParams;

const invoiceId = sp.get("invoice") ?? sp.get("invoice_id") ?? null;
const amount = sp.get("amount");
const currency = (sp.get("currency") ?? "USD").toUpperCase();

// Optional “return” link if you pass it in:
// ?return=https://yourapp.com/somewhere
const returnUrl = sp.get("return");
const safeReturnUrl =
  returnUrl &&
  (returnUrl.startsWith("https://") || returnUrl.startsWith("http://"))
    ? returnUrl
    : null;

const formatMoney = (a: string | null, c: string) => {
  if (!a) return null;
  const n = Number(a);
  if (!Number.isFinite(n)) return null;
  try {
    return new Intl.NumberFormat("en-US", {
      style: "currency",
      currency: c,
    }).format(n);
  } catch {
    return `$${n.toFixed(2)}`;
  }
};

const paidLine = formatMoney(amount, currency);
---

<BaseLayout
  title="Payment received — Invoice Americano"
  description="Payment received confirmation for Invoice Americano."
>
  <!-- App-only page: hide main site chrome -->
  <style is:global>
    /* Hide site navbar/footer so this feels like an app system page */
    header,
    nav,
    footer {
      display: none !important;
    }

    /* If BaseLayout wraps content in main, keep it full-height */
    main {
      min-height: 100vh;
    }
  </style>

  <section
    class="relative min-h-screen overflow-hidden bg-[#05060f] text-slate-100"
  >
    <!-- Background system (same family as the site, but calmer / app-like) -->
    <div class="pointer-events-none absolute inset-0 -z-10">
      <div
        class="absolute -left-24 -top-10 h-80 w-80 rounded-full bg-resync-600/20 blur-3xl"
      >
      </div>
      <div
        class="absolute -right-10 top-0 h-96 w-96 rounded-full bg-[#0d172a] blur-[140px]"
      >
      </div>
      <div
        class="absolute inset-0 bg-[radial-gradient(circle_at_25%_20%,rgba(255,255,255,0.06),transparent_35%),radial-gradient(circle_at_85%_0%,rgba(225,29,72,0.10),transparent_30%),radial-gradient(circle_at_55%_75%,rgba(255,255,255,0.05),transparent_42%)]"
      >
      </div>
      <div
        class="absolute inset-0 bg-[linear-gradient(180deg,rgba(0,0,0,0.55),rgba(0,0,0,0.25),rgba(0,0,0,0.70))]"
      >
      </div>
      <div
        class="absolute inset-0 opacity-[0.16] bg-[radial-gradient(circle_at_1px_1px,rgba(255,255,255,0.16)_1px,transparent_1px)] bg-size-[10px_10px]"
      >
      </div>
      <div
        class="absolute inset-0 bg-[radial-gradient(140%_120%_at_50%_10%,transparent_20%,rgba(0,0,0,0.85)_85%)]"
      >
      </div>
    </div>

    <div
      class="mx-auto flex min-h-screen max-w-6xl items-center justify-center px-6 py-14"
    >
      <!-- App-style confirmation sheet -->
      <div
        class="w-full max-w-lg rounded-[22px] border border-white/10 bg-white/5 p-8 shadow-[0_28px_110px_rgba(0,0,0,0.55)] backdrop-blur-md md:p-10"
      >
        <div class="flex items-center gap-3">
          <div
            class="grid h-11 w-11 place-items-center rounded-2xl border border-white/10 bg-white/6 shadow-[0_12px_45px_rgba(0,0,0,0.35)]"
          >
            <!-- simple “success” dot (keep it subtle, app-like) -->
            <span class="h-2.5 w-2.5 rounded-full bg-emerald-400"></span>
          </div>
          <p
            class="text-xs font-semibold uppercase tracking-wider text-slate-100/70"
          >
            Payment Received
          </p>
        </div>

        <h1 class="mt-6 text-4xl font-black tracking-tight text-white">
          Thanks!
        </h1>

        <p class="mt-3 text-base leading-relaxed text-slate-200/85">
          Your payment was successful. You can close this window.
        </p>

        {
          (paidLine || invoiceId) && (
            <div class="mt-6 grid gap-3">
              {paidLine && (
                <div class="rounded-xl2 border border-white/10 bg-white/4 p-5">
                  <p class="text-[11px] font-semibold uppercase tracking-wider text-slate-100/60">
                    Amount paid
                  </p>
                  <p class="mt-1 text-lg font-bold text-white">{paidLine}</p>
                </div>
              )}

              {invoiceId && (
                <div class="rounded-xl2 border border-white/10 bg-white/4 p-5">
                  <p class="text-[11px] font-semibold uppercase tracking-wider text-slate-100/60">
                    Invoice
                  </p>
                  <p class="mt-1 font-mono text-sm text-slate-200/90">
                    {invoiceId}
                  </p>
                </div>
              )}
            </div>
          )
        }

        <p class="mt-6 text-xs leading-relaxed text-slate-200/55">
          If you reached this page by mistake, you can safely close it.
        </p>
      </div>
    </div>

    <style>
      /* App-like secondary button (keeps your palette, but feels more iOS/system) */
      .ia-secondary {
        display: inline-flex;
        align-items: center;
        gap: 0.4rem;
        padding: 0.9rem 1rem;
        border-radius: 14px;
        border: 1px solid rgba(255, 255, 255, 0.14);
        background: rgba(255, 255, 255, 0.05);
        color: rgba(255, 255, 255, 0.86);
        font-weight: 700;
        box-shadow: 0 18px 55px rgba(0, 0, 0, 0.35);
        backdrop-filter: blur(10px);
        transition:
          transform 0.18s ease,
          background 0.18s ease,
          border-color 0.18s ease;
        text-decoration: none;
      }
      .ia-secondary:hover {
        transform: translateY(-1px);
        background: rgba(255, 255, 255, 0.07);
        border-color: rgba(255, 255, 255, 0.2);
        color: rgba(255, 255, 255, 0.95);
      }

      /* Make sure primary button centers nicely when used in grid */
      :global(.rt-btn-primary) {
        display: inline-flex;
        align-items: center;
      }

      @media (max-width: 639px) {
        .ia-secondary {
          padding: 0.95rem 1rem;
        }
      }
    </style>
  </section>
</BaseLayout>
